/*\
module-type: library
title: $:/plugins/tiddlybase/browser-test-utils/test-utils.js
type: application/javascript
\*/

(()=>{"use strict";var e={189:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openTiddler=t.initSpy=t.findNavigator=t.sleep=t.toJSON=void 0;var n=o(368);Object.defineProperty(t,"toJSON",{enumerable:!0,get:function(){return n.toJSON}});t.sleep=async(e=1e3)=>new Promise((t=>setTimeout(t,e)));t.findNavigator=(e=$tw.rootWidget)=>{const o=e=>"navigator"===e?.parseTreeNode?.type;for(let n of e.children||[]){if(o(n))return n;const e=(0,t.findNavigator)(n);if(e)return e}};let i;t.initSpy=(e,o)=>{let n=[];const i=spyOn(e,o).and.callFake((function(...e){let t;for(t of(console.log(`[spy:${o}] invoked function, waitingResolves`,n),n))console.log("invoking resolver",t),t({args:e,target:this,method:o,spy:i});return console.log(`[spy:${o}] calling original function ${o}`),i.and.originalFn.apply(this,e)}));return{spy:i,waitFor:({label:e,timeout:i=1e3})=>new Promise(((r,a)=>{n.push((t=>r({label:e,timeout:i,...t}))),console.log(`[waitFor:${o}] registering new wait for promise ${e}`,n),(0,t.sleep)(i).then((()=>a(new Error(`timeout after waiting ${i} waiting ${e}`))))}))}};t.openTiddler=async e=>(i=i??(0,t.findNavigator)(),i?.dispatchEvent({type:"tm-close-all-tiddlers"}),i?.dispatchEvent({type:"tm-navigate",navigateTo:e}),await(0,t.sleep)(0))},368:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;t.toJSON=e=>{let o={nodeType:(e=e||this).nodeType};return e instanceof HTMLElement&&(e.tagName&&(o.tagName=e.tagName.toLowerCase()),e.attributes&&(o.attributes=Object.fromEntries([...e.attributes].map((e=>[e.name,e.value]))))),e.nodeName&&(o.nodeName=e.nodeName),e.nodeValue&&(o.nodeValue=e.nodeValue),e.childNodes&&(o.childNodes=[...e.childNodes].map((e=>(0,t.toJSON)(e)))),o}}},t={};var o=function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(189),n=exports;for(var i in o)n[i]=o[i];o.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/test-utils.js.map