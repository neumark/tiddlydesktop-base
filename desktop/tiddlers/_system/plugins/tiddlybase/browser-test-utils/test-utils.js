/*\
module-type: library
title: $:/plugins/tiddlybase/browser-test-utils/test-utils.js
type: application/javascript
\*/

(()=>{"use strict";var e={189:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTiddlerDiv=t.getCurrentTiddler=t.openTiddler=t.initSpy=t.findNavigator=t.sleep=t.toJSON=void 0;var i=o(368);Object.defineProperty(t,"toJSON",{enumerable:!0,get:function(){return i.toJSON}});t.sleep=async(e=1e3)=>new Promise((t=>setTimeout(t,e)));t.findNavigator=(e=$tw.rootWidget)=>{const o=e=>"navigator"===e?.parseTreeNode?.type;for(let i of e.children||[]){if(o(i))return i;const e=(0,t.findNavigator)(i);if(e)return e}};let r;t.initSpy=(e,o)=>{let i=[];const r=spyOn(e,o).and.callFake((function(...e){let t;for(t of(console.log(`[spy:${o}] invoked function, waitingResolves`,i),i))console.log("invoking resolver",t),t({args:e,target:this,method:o,spy:r});return console.log(`[spy:${o}] calling original function ${o}`),r.and.originalFn.apply(this,e)}));return{spy:r,waitFor:({label:e,timeout:r=1e3})=>new Promise(((n,a)=>{i.push((t=>n({label:e,timeout:r,...t}))),console.log(`[waitFor:${o}] registering new wait for promise ${e}`,i),(0,t.sleep)(r).then((()=>a(new Error(`timeout after waiting ${r} waiting ${e}`))))}))}};t.openTiddler=async e=>(r=r??(0,t.findNavigator)(),r?.dispatchEvent({type:"tm-close-all-tiddlers"}),r?.dispatchEvent({type:"tm-navigate",navigateTo:e}),await(0,t.sleep)(0));t.getCurrentTiddler=()=>$tw.wiki.getTiddler("$:/HistoryList")?.fields["current-tiddler"];t.getTiddlerDiv=e=>document.querySelectorAll(`div[data-tiddler-title="${e}"]`)?.[0]},368:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toJSON=void 0;t.toJSON=e=>{let o={nodeType:(e=e||this).nodeType};return e instanceof HTMLElement?(e.tagName&&(o.tagName=e.tagName.toLowerCase()),e.attributes&&(o.attributes=Object.fromEntries([...e.attributes].map((e=>[e.name,e.value]))))):e.nodeName&&(o.nodeName=e.nodeName),e.nodeValue&&(o.nodeValue=e.nodeValue),e.childNodes&&(o.childNodes=[...e.childNodes].map((e=>(0,t.toJSON)(e)))),o}}},t={};var o=function o(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,o),n.exports}(189),i=exports;for(var r in o)i[r]=o[r];o.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/plugins/tiddlybase/browser-test-utils/test-utils.js.map