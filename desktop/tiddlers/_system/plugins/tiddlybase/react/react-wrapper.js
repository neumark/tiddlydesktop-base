/*\
module-type: widget
title: $:/plugins/tiddlybase/react/react-wrapper.js
type: application/javascript
\*/

(()=>{"use strict";var e={271:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactWrapperError=void 0;const o=r(30);t.ReactWrapperError=({message:e})=>(0,o.jsx)("div",{children:e})},783:e=>{e.exports=require("$:/core/modules/widgets/widget.js")},922:e=>{e.exports=require("$:/plugins/tiddlybase/react/components/TW5ReactContext.js")},381:e=>{e.exports=require("$:/plugins/tiddlybase/react/dom-removal-detector.js")},649:e=>{e.exports=require("$:/plugins/tiddlybase/react/react-dom.js")},30:e=>{e.exports=require("$:/plugins/tiddlybase/react/react-jsx-runtime.js")}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.ReactWrapper=void 0;const t=r(381),s=r(649),i=r(271),n=r(922),{widget:d}=r(783),a=require,u=d,c=e=>(0,i.ReactWrapperError)({message:e});e.ReactWrapper=class extends u{async getRenderable(){const{module:e,export:t="default",...r}=this.attributes;if(!e)return c('Must set "module" widget attribute.');if(!t)return c('Must set "export" widget attribute.');let o;try{o=a(e)}catch(t){return c("MODULE_NOT_FOUND"===t?.code?`The module '${e}' could not be found.`:`require error: ${String(t)}`)}const s=o[t];if(void 0===s)return c(`The module's '${t}' module undefined.`);let i=!1;t.endsWith("Factory")&&(console.log(`react-wrapper: considering export ${t} a factory`),i=!0);try{const e=i?await s({require:a,parentWidget:this,...r}):s;return(0,n.withContextProvider)({context:{parentWidget:this},Component:e,props:r})}catch(e){return c(`Error rendering component '${t}': ${String(e)}`)}}render(e,t){this.parentDomNode=e,this.computeAttributes(),this.domNodes?.length>0&&this.removeChildDomNodes();const r=this.document.createElement("div");this.getRenderable().then((e=>this.initReact(e,r,!0))),e.insertBefore(r,t),this.domNodes=[r]}destroy(){this.domNodes[0]&&(0,t.unmonitorRemoval)(this.domNodes[0]),this.root&&this.root.unmount(),this.root=void 0}removeChildDomNodes(){this.destroy(),super.removeChildDomNodes()}async initReact(e,r,o=!1){r&&(this.root||(this.root=(0,s.createRoot)(r)),e&&this.root.render(e),o&&(0,t.monitorRemoval)(r,(()=>{console.log("widget root DOM element orphaned, unmounting"),this.destroy()})))}refresh(e){var t=this.computeAttributes();let r=!1;Object.keys(t).length>0&&(console.log("attributes changed, rerendering component"),this.getRenderable().then((e=>this.initReact(e,this.domNodes[0]))),r=!0);const o=this.refreshChildren(e);return r||o}}})();var s=exports;for(var i in o)s[i]=o[i];o.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/plugins/tiddlybase/react/react-wrapper.js.map