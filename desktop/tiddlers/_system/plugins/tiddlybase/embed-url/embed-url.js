/*\
module-type: widget
title: $:/plugins/tiddlybase/embed-url/embed-url.js
type: application/javascript
\*/

(()=>{"use strict";var e={783:e=>{e.exports=require("$:/core/modules/widgets/widget.js")}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{i.r(r),i.d(r,{EmbedURL:()=>S});const e=["download","open-in-new-tab-on-click"],t=require("$:/plugins/tiddlybase/adaptors-lib/url.js"),s=require("$:/plugins/tiddlybase/adaptors-lib/wiki-info-config.js"),n={jpg:"image",jpeg:"image",png:"image",gif:"image",heic:"image",svg:"image",mp4:"video",mov:"video",mkv:"video",pdf:"embed"},o={youtube:'<i class="prefix-icon fa-brands fa-youtube" aria-hidden="true"></i>',pdf:'<i class="prefix-icon fa fa-file-pdf" aria-hidden="true"></i>',file:'<i class="prefix-icon fa fa-file" aria-hidden="true"></i>'},d="true"===(0,s.getWikiInfoConfigValue)("display-link-icons"),a=['target="_blank"','rel="noopener"',"noreferrer"],c=new RegExp("^https://www.youtube.com/watch\\?v=([a-zA-Z0-9]+)"),l=(e,t,i)=>t[e]?`${i??e}="${t[e]}" `:"",u=(e,t=[],i="")=>`<a href="${e}" ${t.join(" ")}>${i}</a>`,p=(e,t)=>({...e,innerHTML:t}),b={image:e=>{const t=`<img src="${e.resolvedSrc}" ${l("height",e)} ${l("width",e)} ${l("description",e,"title")} />`;return p(e,e.parsedAttributes.includes("open-in-new-tab-on-click")?u(e.resolvedSrc,a,t):t)},video:e=>p(e,`\n      <video controls ${l("height",e)} ${l("width",e)}>\n        <source src="${e.resolvedSrc}" />\n      </video>`),embed:e=>p(e,`<embed src="${e.resolvedSrc}" ${l("height",e)} ${l("width",e)} />`),link:e=>{let t=[];return e.parsedAttributes.includes("download")&&(t=[`download="${e.src.split("/").slice(-1)[0]}"`]),e.parsedAttributes.includes("open-in-new-tab-on-click")&&(t=a),p({...e,cssClasses:["embed-inline-link-container"]},u(e.resolvedSrc,t,(i=e.icon,r=e.description,`${i?o[i]:""}${r||""}`)));var i,r},iframe:e=>p(e,`<iframe\n      frameborder="0"\n      scrolling="no"\n      marginheight="0"\n      marginwidth="0"\n      ${l("height",e)}\n      ${l("width",e)}\n      src="${e.resolvedSrc}"></iframe>`)},h=["tc-tiddler-body","tc-reveal"],f=(e,t)=>({...e,parsedAttributes:e.parsedAttributes.concat(t)}),g=e=>"pdf"===e?"pdf":"file",m=e=>{if(e.parsedAttributes.includes("download")){let i;if(d){const r=(0,t.getExtension)(e.resolvedSrc);i=r?g(r):void 0}return b.link({...e,icon:i})}const i=e.resolvedSrc.match(c)?.[1];if(i)return e.inSandboxedIframe?b.link(f({...e,icon:d?"youtube":void 0},"open-in-new-tab-on-click")):b.iframe({...e,resolvedSrc:`https://www.youtube.com/embed/${i}`});const r=(0,t.getExtension)(e.resolvedSrc);let s=(r?n[r]:void 0)??"link";return e.inSandboxedIframe&&"embed"===s?b.link(f({...e,description:e.description||e.src,icon:d&&r?g(r):void 0},"open-in-new-tab-on-click")):b[s](e)},v=(i,r)=>{const s=i.createElement("div"),n=t=>{const i=r.cssClasses??h.slice(),n=((o=r.attributes)?o.split(","):[]).reduce(((t,i)=>{const r=i.trim();return e.includes(r)?t.push(r):console.warn("ignoring unknown embed-url attribute "+i),t}),[]);var o;const d=((e,t,i,r)=>({...e,resolvedSrc:t,cssClasses:i,parsedAttributes:r,inSandboxedIframe:$tw?.tiddlybase?.inSandboxedIframe??!1}))(r,t,i,n),a=m(d);((e,t)=>{t?.forEach((t=>e?.classList?.add(t)))})(s,a.cssClasses),s.innerHTML=a.innerHTML},o=(0,t.resolveURL)(r.src);return"string"==typeof o?n(o):(s.innerHTML=w(r),o.then(n)),s},w=e=>"loading...",{widget:$}=i(783),y=$;class S extends y{constructor(e,t){super(e,t)}render(e,t){this.parentDomNode=e,this.computeAttributes(),this.execute();const i=v(this.document,this.props);e.insertBefore(i,t),this.domNodes.push(i)}execute(){this.props={src:this.getAttribute("src"),width:this.getAttribute("width"),height:this.getAttribute("height"),description:this.getAttribute("description"),attributes:this.getAttribute("attributes")}}refresh(){var e=this.computeAttributes();return!!(e.src||e.width||e.height||e.description||e.attributes)&&(this.refreshSelf(),!0)}}})();var s=exports;for(var n in r)s[n]=r[n];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/embed-url.js.map