/*\
module-type: widget
title: $:/plugins/tiddlybase/embed-url/embed-url.js
type: application/javascript
\*/

(()=>{"use strict";var e={56:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LINK_ICONS=t.EXTENSION_TO_OBJECT_TYPE=void 0,t.EXTENSION_TO_OBJECT_TYPE={gif:"image",heic:"image",jpeg:"image",jpg:"image",m4a:"audio",mkv:"video",mov:"video",mp4:"video",pdf:"embed",png:"image",svg:"image"},t.LINK_ICONS={youtube:'<i class="prefix-icon fa-brands fa-youtube" aria-hidden="true"></i>',pdf:'<i class="prefix-icon fa fa-file-pdf" aria-hidden="true"></i>',file:'<i class="prefix-icon fa fa-file" aria-hidden="true"></i>'}},461:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDomNode=t.generateHtml=void 0;const r=i(701),s=i(172),n=i(625),o=i(56),d=!0===(0,n.getWikiInfoConfigValue)("display-link-icons"),a=['target="_blank"','rel="noopener"',"noreferrer"],c=new RegExp("^https://www.youtube.com/watch\\?v=([a-zA-Z0-9]+)"),l=(e,t,i)=>t[e]?`${i??e}="${t[e]}" `:"",u=(e,t=[],i="")=>`<a href="${e}" ${t.join(" ")}>${i}</a>`,p=(e,t)=>({...e,innerHTML:t}),b={image:e=>{const t=`<img src="${e.resolvedSrc}" ${l("height",e)} ${l("width",e)} ${l("description",e,"title")} />`;return p(e,e.parsedAttributes.includes("open-in-new-tab-on-click")?u(e.resolvedSrc,a,t):t)},video:e=>p(e,`\n      <video controls ${l("height",e)} ${l("width",e)}>\n        <source src="${e.resolvedSrc}" />\n      </video>`),audio:e=>p(e,`\n      <audio controls ${l("height",e)} ${l("width",e)}>\n        <source src="${e.resolvedSrc}" />\n      </audio>`),embed:e=>p(e,`<embed src="${e.resolvedSrc}" ${l("height",e)} ${l("width",e)} />`),link:e=>{let t=[];return e.parsedAttributes.includes("download")&&(t=[`download="${e.src.split("/").slice(-1)[0]}"`]),e.parsedAttributes.includes("open-in-new-tab-on-click")&&(t=a),p({...e,cssClasses:["embed-inline-link-container"]},u(e.resolvedSrc,t,(i=e.icon,r=e.description,`${i?o.LINK_ICONS[i]:""}${r||""}`)));var i,r},iframe:e=>p(e,`<iframe\n      frameborder="0"\n      scrolling="no"\n      marginheight="0"\n      marginwidth="0"\n      ${l("height",e)}\n      ${l("width",e)}\n      src="${e.resolvedSrc}"></iframe>`)},h=["tc-tiddler-body","tc-reveal"],g=(e,t)=>({...e,parsedAttributes:e.parsedAttributes.concat(t)}),f=e=>"pdf"===e?"pdf":"file";t.generateHtml=e=>{if(e.parsedAttributes.includes("download")){let t;if(d){const i=(0,s.getExtension)(e.resolvedSrc);t=i?f(i):void 0}return b.link({...e,icon:t})}const t=e.resolvedSrc.match(c)?.[1];if(t)return e.inSandboxedIframe?b.link(g({...e,icon:d?"youtube":void 0},"open-in-new-tab-on-click")):b.iframe({...e,resolvedSrc:`https://www.youtube.com/embed/${t}`});const i=(0,s.getExtension)(e.resolvedSrc);let r=(i?o.EXTENSION_TO_OBJECT_TYPE[i]:void 0)??"link";return e.inSandboxedIframe&&"embed"===r?b.link(g({...e,description:e.description||e.src,icon:d&&i?f(i):void 0},"open-in-new-tab-on-click")):b[r](e)};t.getDomNode=(e,i)=>{const n=e.createElement("div"),o=e=>{const s=i.cssClasses??h.slice(),o=((d=i.attributes)?d.split(","):[]).reduce(((e,t)=>{const i=t.trim();return r.EMBED_ATTRIBUTES.includes(i)?e.push(i):console.warn("ignoring unknown embed-url attribute "+t),e}),[]);var d;const a=((e,t,i,r)=>({...e,resolvedSrc:t,cssClasses:i,parsedAttributes:r,inSandboxedIframe:$tw?.tiddlybase?.inSandboxedIframe??!1}))(i,e,s,o),c=(0,t.generateHtml)(a);((e,t)=>{t?.forEach((t=>e?.classList?.add(t)))})(n,c.cssClasses),n.innerHTML=c.innerHTML},d=(0,s.resolveURL)(i.src);return"string"==typeof d?o(d):(n.innerHTML=m(i),d.then(o)),n};const m=e=>"loading..."},701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EMBED_ATTRIBUTES=void 0,t.EMBED_ATTRIBUTES=["download","open-in-new-tab-on-click"]},783:e=>{e.exports=require("$:/core/modules/widgets/widget.js")},172:e=>{e.exports=require("$:/plugins/tiddlybase/tiddlybase-utils/url.js")},625:e=>{e.exports=require("$:/plugins/tiddlybase/tiddlybase-utils/wiki-info-config.js")}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.EmbedURL=void 0;const t=i(461),{widget:s}=i(783),n=s;e.EmbedURL=class extends n{constructor(e,t){super(e,t)}render(e,i){this.parentDomNode=e,this.computeAttributes(),this.execute();const r=(0,t.getDomNode)(this.document,this.props);e.insertBefore(r,i),this.domNodes.push(r)}execute(){this.props={src:this.getAttribute("src"),width:this.getAttribute("width"),height:this.getAttribute("height"),description:this.getAttribute("description"),attributes:this.getAttribute("attributes")}}refresh(){var e=this.computeAttributes();return!!(e.src||e.width||e.height||e.description||e.attributes)&&(this.refreshSelf(),!0)}}})();var s=exports;for(var n in r)s[n]=r[n];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/plugins/tiddlybase/embed-url/embed-url.js.map