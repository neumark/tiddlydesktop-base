/*\
module-type: library
title: $:/plugins/tiddlybase/embed-media/embed-media.js
type: application/javascript
\*/

(()=>{"use strict";var e={56:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EXTENSION_TO_OBJECT_TYPE=void 0,s.EXTENSION_TO_OBJECT_TYPE={gif:"image",heic:"image",jpeg:"image",jpg:"image",m4a:"audio",mkv:"video",mov:"video",mp4:"video",pdf:"embed",png:"image",svg:"image"}},614:(e,s,r)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.MediaNode=s.generateHtml=s.LINK_ICONS=void 0;const i=r(30),t=r(701),n=r(172),o=r(625),a=r(56),d=r(434),c=!0===(0,o.getWikiInfoConfigValue)("display-link-icons");s.LINK_ICONS={youtube:(0,i.jsx)("i",{className:"prefix-icon fa-brands fa-youtube","aria-hidden":"true"}),pdf:(0,i.jsx)("i",{className:"prefix-icon fa fa-file-pdf","aria-hidden":"true"}),file:(0,i.jsx)("i",{className:"prefix-icon fa fa-file","aria-hidden":"true"})};const l={target:"_blank",rel:"noopener",referrerPolicy:"no-referrer"},u=new RegExp("^https://www.youtube.com/watch\\?v=([a-zA-Z0-9]+)"),m=(e,s,r,i)=>s[r]?Object.assign(e,{[i??r]:s[r]}):e,p=(e,s={},r=null)=>(0,i.jsx)("a",{href:e,...s,children:r}),b=(e,s)=>({...e,element:s}),f={image:e=>{const s={className:e.cssClasses.join(" "),src:e.resolvedSrc};m(s,e,"height"),m(s,e,"width"),m(s,e,"description","title");const r=(0,i.jsx)("img",{...s});return b(e,e.parsedAttributes.has("open-in-new-tab-on-click")?p(e.resolvedSrc,l,r):r)},video:e=>{const s={className:e.cssClasses.join(" ")};return m(s,e,"height"),m(s,e,"width"),b(e,(0,i.jsx)("video",{controls:!0,...s,children:(0,i.jsx)("source",{src:e.resolvedSrc})}))},audio:e=>{const s={className:e.cssClasses.join(" ")};return m(s,e,"height"),m(s,e,"width"),b(e,(0,i.jsx)("audio",{controls:!0,...s,children:(0,i.jsx)("source",{src:e.resolvedSrc})}))},embed:e=>{const s={className:e.cssClasses.join(" ")};return m(s,e,"height"),m(s,e,"width"),b(e,(0,i.jsx)("embed",{src:e.resolvedSrc,...s}))},link:e=>{const r={};let t=["embed-inline-link-container"];return e.parsedAttributes.has("download")&&(r.download=e.src.split("/").slice(-1)[0]),e.parsedAttributes.has("open-in-new-tab-on-click")&&Object.assign(r,l),b({...e,cssClasses:t},p(e.resolvedSrc,{...r,className:[...t,e.cssClasses].join(" ")},(n=e.icon,o=e.description,(0,i.jsxs)(i.Fragment,{children:[n?s.LINK_ICONS[n]:null,o]}))));var n,o},iframe:e=>{const s={className:e.cssClasses.join(" ")};return m(s,e,"height"),m(s,e,"width"),b(e,(0,i.jsx)("iframe",{frameBorder:0,scrolling:"no",marginHeight:0,marginWidth:0,src:e.resolvedSrc,...s}))}},v=["tc-tiddler-body","tc-reveal"],g=(e,s)=>({...e,parsedAttributes:new Set([...e.parsedAttributes,s])}),h=e=>"pdf"===e?"pdf":"file";s.generateHtml=e=>{if(e.parsedAttributes.has("download")){let s;if(c){const r=(0,n.getExtension)(e.resolvedSrc);s=r?h(r):void 0}return f.link({...e,icon:s})}const s=e.resolvedSrc.match(u)?.[1];if(s)return e.inSandboxedIframe?f.link(g({...e,icon:c?"youtube":void 0},"open-in-new-tab-on-click")):f.iframe({...e,resolvedSrc:`https://www.youtube.com/embed/${s}`});const r=(0,n.getExtension)(e.resolvedSrc);let i=(r?a.EXTENSION_TO_OBJECT_TYPE[r]:void 0)??"link";return e.inSandboxedIframe&&"embed"===i?f.link(g({...e,description:e.description||e.src,icon:c&&r?h(r):void 0},"open-in-new-tab-on-click")):f[i](e)};s.MediaNode=e=>{const{src:r}=e,[i,o]=(0,d.useState)(null);(0,d.useEffect)((()=>{Promise.resolve((0,n.resolveURL)(r)).then(o)}),[r]);return i?(()=>{const r=e.cssClasses??v.slice(),n=((o=e.attributes)?o.split(","):[]).reduce(((e,s)=>{const r=s.trim();return t.EMBED_ATTRIBUTES.includes(r)?e.add(r):console.warn("ignoring unknown embed-url attribute "+s),e}),new Set);var o;const a=((e,s,r,i)=>({...e,resolvedSrc:s,cssClasses:r,parsedAttributes:i,inSandboxedIframe:$tw?.tiddlybase?.inSandboxedIframe??!1}))(e,i,r,n);return(0,s.generateHtml)(a).element})():j(e)};const j=e=>(0,i.jsx)(i.Fragment,{children:'"loading..."'})},701:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EMBED_ATTRIBUTES=void 0,s.EMBED_ATTRIBUTES=["download","open-in-new-tab-on-click"]},30:e=>{e.exports=require("$:/plugins/tiddlybase/react/react-jsx-runtime.js")},434:e=>{e.exports=require("$:/plugins/tiddlybase/react/react.js")},172:e=>{e.exports=require("$:/plugins/tiddlybase/tiddlybase-utils/url.js")},625:e=>{e.exports=require("$:/plugins/tiddlybase/tiddlybase-utils/wiki-info-config.js")}},s={};function r(i){var t=s[i];if(void 0!==t)return t.exports;var n=s[i]={exports:{}};return e[i](n,n.exports,r),n.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.EmbedMedia=void 0;const s=r(614);e.EmbedMedia=e=>(0,s.MediaNode)(e)})();var t=exports;for(var n in i)t[n]=i[n];i.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})})();
//# sourceMappingURL=/sourcemaps/plugins/tiddlybase/embed-media/embed-media.js.map